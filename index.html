<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">
    
    <title>EcoPoint Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://unpkg.com/html5-qrcode"></script>

    <style>
        /* CSS D…ôyi≈ü…ônl…ôri */
        :root { 
            --bg-body: #0f172a; 
            --bg-card: #1e293b; 
            --primary: #00ff88; 
            --text-main: #ffffff; 
            --text-muted: #94a3b8; 
            --border: rgba(255,255,255,0.08); 
            --admin-color: #f59e0b; 
        }
        
        body.light-mode { 
            --bg-body: #f1f5f9; 
            --bg-card: #ffffff; 
            --primary: #059669; 
            --text-main: #0f172a; 
            --text-muted: #64748b; 
            --border: rgba(0,0,0,0.08); 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg-body); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; transition: background 0.3s; overflow-x: hidden; }

        /* Gƒ∞Rƒ∞≈û S∆èHƒ∞F∆èSƒ∞ */
        #auth-view { position: fixed; inset: 0; z-index: 5000; background: radial-gradient(circle at top right, #004d3d, var(--bg-body)); display: flex; flex-direction: column; justify-content: flex-end; padding: 40px; }
        .auth-btn { width: 100%; padding: 18px; background: #fff; color: #000; border: none; border-radius: 18px; font-weight: 700; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; }

        /* ∆èSAS T∆èTBƒ∞Q */
        #app-view { display: none; flex: 1; flex-direction: column; opacity: 0; transition: opacity 0.8s ease-in-out; }

        /* Header */
        .header { padding: 50px 20px 15px; display: flex; justify-content: space-between; align-items: center; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); z-index: 100; position: sticky; top: 0; }
        .user-chip { display: flex; align-items: center; gap: 12px; background: var(--bg-card); padding: 6px 16px 6px 6px; border-radius: 50px; border: 1px solid var(--border); }
        .u-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; }
        .admin-badge { display: none; background: var(--admin-color); color: #000; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 800; margin-left: 5px; }

        .header-actions { display: flex; gap: 10px; }
        .icon-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-main); display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* M…ôzmun */
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; }
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        .card { background: var(--bg-card); border-radius: 24px; padding: 25px; border: 1px solid var(--border); margin-bottom: 15px; }

        /* ADMIN PANEL Dƒ∞ZAYNI */
        .admin-box { display: none; border: 2px solid var(--admin-color); background: rgba(245, 158, 11, 0.05); }
        .admin-input { width: 100%; background: var(--bg-body); border: 1px solid var(--border); padding: 15px; color: var(--text-main); border-radius: 15px; margin-bottom: 12px; font-size: 14px; }
        .admin-btn { background: var(--admin-color); color: #000; width: 100%; padding: 15px; border: none; border-radius: 15px; font-weight: 700; cursor: pointer; margin-top: 5px; }
        .user-scroll-area { margin-top: 15px; max-height: 250px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 15px; padding: 10px; border: 1px solid var(--border); }
        .user-card { padding: 12px; border-bottom: 1px solid var(--border); display: flex; flex-direction: column; gap: 4px; text-align: left; }
        .user-card b { color: var(--primary); font-size: 13px; }
        .user-card span { font-size: 10px; color: var(--text-muted); }

        /* Balans Kartƒ± */
        .balance-hero { background: linear-gradient(135deg, var(--bg-card), #000); border: 1px solid var(--primary); padding: 30px 25px; position: relative; overflow: hidden; }
        .balance-val { font-size: 48px; font-weight: 800; color: var(--text-main); }
        
        /* F…ôaliyy…ôt D√ºym…ôl…ôri */
        .action-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin: 25px 0; }
        .act-btn { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; padding: 15px 5px; display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: transform 0.2s; }
        .act-btn:active { transform: scale(0.95); }
        .act-icon { width: 40px; height: 40px; background: rgba(0, 255, 136, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 18px; }
        .act-btn span { font-size: 11px; font-weight: 600; }

        /* Menu */
        .nav { position: fixed; bottom: 0; width: 100%; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); padding: 15px 25px 35px; display: flex; justify-content: space-between; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 5px; color: var(--text-muted); font-size: 11px; font-weight: 600; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .scan-fab { width: 75px; height: 75px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; color: #000; border: 8px solid var(--bg-body); position: relative; top: -45px; box-shadow: 0 10px 20px rgba(0, 255, 136, 0.4); cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="auth-view">
        <div style="margin-top: auto; margin-bottom: 50px;">
            <img src="icon.png" style="width: 130px; border-radius: 20px; margin-bottom: 25px;">
            <h1 style="margin:0; font-size:42px;">EcoPoint<br><span style="color:var(--primary)">Pro</span></h1>
            <p style="color:var(--text-muted); margin-bottom:35px;">T…ômiz g…ôl…ôc…ôk √º√ß√ºn.</p>
            <button class="auth-btn" onclick="login()">
                <i class="fa-brands fa-google" style="font-size: 20px;"></i>
                <span>Google il…ô giri≈ü</span>
            </button>
        </div>
    </div>

    <div id="app-view">
        <div class="header">
            <div class="user-chip" onclick="switchTab('profile')">
                <img src="" id="u-img" class="u-avatar">
                <div style="display:flex; flex-direction:column;">
                    <span id="u-name" style="font-size: 14px; font-weight: 800;">...</span>
                    <span id="admin-tag" class="admin-badge">ADMIN</span>
                </div>
            </div>
            
            <div class="header-actions">
                <div class="icon-btn" onclick="toggleTheme()"><i class="fa-solid fa-moon"></i></div>
                <div class="icon-btn" onclick="toggleLang()">AZ</div>
                <div class="icon-btn" onclick="logout()" style="border-color: #ef4444; color: #ef4444;"><i class="fa-solid fa-right-from-bracket"></i></div>
            </div>
        </div>

        <div class="content">
            <div id="page-home" class="page active">
                
                <div id="admin-panel" class="card admin-box">
                    <h3 style="color: var(--admin-color); margin-top: 0;"><i class="fa-solid fa-crown"></i> ADMIN PANEL</h3>
                    
                    <label style="font-size:12px; color:var(--text-muted);">Xal G√∂nd…ôr:</label>
                    <input type="text" id="target-uid" class="admin-input" placeholder="ƒ∞stifad…ô√ßi UID (Bo≈ü burax = Hamƒ±ya)">
                    <input type="number" id="target-amount" class="admin-input" placeholder="Miqdar (m…ôs: 50)">
                    <button class="admin-btn" onclick="adminSendPoints()">G√ñND∆èR üöÄ</button>
                    
                    <div style="margin-top:20px;">
                        <span style="font-size: 12px; color: var(--admin-color); font-weight: 800;">ƒ∞stifad…ô√ßil…ôr:</span>
                        <div id="admin-user-list" class="user-scroll-area">
                            <p style="font-size:11px; text-align:center;">Y√ºkl…ônir...</p>
                        </div>
                    </div>
                </div>

                <div class="card balance-hero">
                    <div id="bal-label" style="font-size: 14px; color: var(--primary); font-weight: 800;">√úMUMƒ∞ BALANS</div>
                    <div style="display: flex; align-items: baseline; gap: 12px; margin-top: 10px;">
                        <div class="balance-val" id="balance-display">0</div>
                        <span style="color: var(--primary); font-weight: 800;">EP</span>
                    </div>
                    <i class="fa-solid fa-leaf" style="position: absolute; right: -20px; bottom: -20px; font-size: 100px; opacity: 0.1; color: var(--primary);"></i>
                </div>
                
                <div class="action-grid">
                    <div class="act-btn" onclick="openScanner()"><div class="act-icon"><i class="fa-solid fa-qrcode"></i></div><span>Skan</span></div>
                    <div class="act-btn" onclick="shareApp()"><div class="act-icon"><i class="fa-solid fa-share-nodes"></i></div><span>Dostuna</span></div>
                    <div class="act-btn" onclick="switchTab('market')"><div class="act-icon"><i class="fa-solid fa-bag-shopping"></i></div><span>Market</span></div>
                    <div class="act-btn" onclick="window.open('https://greenlinegroupazerbaijan2026.netlify.app/', '_blank')"><div class="act-icon"><i class="fa-solid fa-circle-info"></i></div><span>Haqqƒ±mƒ±zda</span></div>
                </div>
            </div>
            
            <div id="page-market" class="page">
                <h2 style="margin-top:0;">Market</h2>
                <div class="card">
                    <p style="text-align:center; color:var(--text-muted);">Tezlikl…ô a√ßƒ±lacaq...</p>
                </div>
            </div>

            <div id="page-profile" class="page">
                <h2 style="margin-top:0;">Profil</h2>
                <div class="card">
                    <p>ƒ∞stifad…ô√ßi ID:</p>
                    <code id="my-uid" style="background:rgba(0,0,0,0.3); padding:5px; display:block; word-break:break-all;">...</code>
                </div>
            </div>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="switchTab('home', this)"><i class="fa-solid fa-house"></i><span>Ana</span></div>
            <div class="nav-item" onclick="switchTab('market', this)"><i class="fa-solid fa-bag-shopping"></i><span>Market</span></div>
            <div style="position: relative; top: -45px;"><div class="scan-fab" onclick="openScanner()"><i class="fa-solid fa-expand"></i></div></div>
            <div class="nav-item" onclick="switchTab('home', this)"><i class="fa-solid fa-chart-pie"></i><span>Stat</span></div>
            <div class="nav-item" onclick="switchTab('profile', this)"><i class="fa-solid fa-user"></i><span>Profil</span></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBGEu8M7I6BSMrcMqd8t-mC1KWhHC-WubM",
            authDomain: "ecopoint-b3d60.firebaseapp.com",
            databaseURL: "https://ecopoint-b3d60-default-rtdb.firebaseio.com",
            projectId: "ecopoint-b3d60",
            storageBucket: "ecopoint-b3d60.firebasestorage.app",
            messagingSenderId: "193692283784",
            appId: "1:193692283784:web:c256a9642dd5688d0b003d",
            measurementId: "G-C5S5X92Z8Q"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const provider = new firebase.auth.GoogleAuthProvider();

        // 1. Gƒ∞Rƒ∞≈û
        function login() {
            auth.signInWithRedirect(provider);
        }

        auth.getRedirectResult().catch(e => console.error(e));

        // 2. ƒ∞STƒ∞FAD∆è√áƒ∞ YOXLANI≈ûI
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-view').style.display = 'none';
                
                const appView = document.getElementById('app-view');
                appView.style.display = 'flex';
                setTimeout(() => { appView.style.opacity = '1'; }, 50);

                document.getElementById('u-name').innerText = user.displayName;
                document.getElementById('u-img').src = user.photoURL;
                document.getElementById('my-uid').innerText = user.uid;

                // --- VACƒ∞B: Yalnƒ±z s…ônin emailin √º√ß√ºn ADMIN paneli a√ßƒ±lƒ±r ---
                checkAdmin(user);

                db.ref('users/' + user.uid + '/details').update({
                    name: user.displayName,
                    email: user.email,
                    photo: user.photoURL,
                    lastLogin: Date.now()
                });

                db.ref('users/' + user.uid + '/balance').on('value', snap => {
                    document.getElementById('balance-display').innerText = snap.val() || 0;
                });

            } else {
                document.getElementById('auth-view').style.display = 'flex';
                document.getElementById('app-view').style.display = 'none';
                document.getElementById('app-view').style.opacity = '0';
            }
        });

        // 3. ADMIN PANELƒ∞Nƒ∞ YOXLAYAN FUNKSƒ∞YA
        function checkAdmin(user) {
            const myEmail = "greenlinegroup2026@gmail.com";
            
            if(user.email === myEmail) {
                // S…ôns…ôns…ô, h…ôr ≈üeyi g√∂st…ôr
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('admin-tag').style.display = 'inline-block';
                loadAdminUserList();
            } else {
                // Ba≈üqasƒ±dƒ±rsa, gizl…ôt
                document.getElementById('admin-panel').style.display = 'none';
                document.getElementById('admin-tag').style.display = 'none';
            }
        }

        function loadAdminUserList() {
            db.ref('users').on('value', snap => {
                const list = document.getElementById('admin-user-list');
                list.innerHTML = '';
                snap.forEach(u => {
                    const info = u.val().details || {};
                    const div = document.createElement('div');
                    div.className = 'user-card';
                    div.innerHTML = `<b>${info.name || 'Adsƒ±z'}</b><span>${u.key}</span>`;
                    div.onclick = () => {
                        document.getElementById('target-uid').value = u.key;
                    };
                    list.appendChild(div);
                });
            });
        }

        function adminSendPoints() {
            const uid = document.getElementById('target-uid').value.trim();
            const amount = parseInt(document.getElementById('target-amount').value);
            
            if(!amount) return alert("Miqdar yaz!");

            if(uid === "") {
                if(confirm("Hamƒ±ya " + amount + " EP g√∂nd…ôril…ôc…ôk. Razƒ±san?")) {
                    db.ref('users').once('value', snap => {
                        snap.forEach(u => {
                            const current = (u.val().balance || 0);
                            db.ref('users/' + u.key + '/balance').set(current + amount);
                        });
                        alert("Hamƒ±ya g√∂nd…ôrildi!");
                    });
                }
            } else {
                db.ref('users/' + uid + '/balance').once('value', snap => {
                    const current = snap.val() || 0;
                    db.ref('users/' + uid + '/balance').set(current + amount);
                    alert("G√∂nd…ôrildi!");
                });
            }
        }

        function toggleTheme() { document.body.classList.toggle('light-mode'); }
        function toggleLang() { alert("Dil d…ôyi≈üimi tezlikl…ô!"); }
        
        function switchTab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            if(el) {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                el.classList.add('active');
            }
        }

        function openScanner() { alert("Kamera a√ßƒ±lƒ±r..."); }
        
        function shareApp() {
            if (navigator.share) {
                navigator.share({ title: 'EcoPoint Pro', text: 'M…ôn…ô qo≈üul!', url: window.location.href });
            } else { alert("Link kopyalandƒ±!"); }
        }

        function logout() { auth.signOut().then(() => window.location.reload()); }
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
    </script>
</body>
</html>
